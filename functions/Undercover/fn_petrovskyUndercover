/*
 * Name:	fn_petrovskyUndercover
 * Date:	27/10/2022
 * Version: 1.0
 * Author:  JB
 *
 * Description:
 * Its in the name...
 *
 * Parameter(s):
 * _PARAM1 (TYPE): DESCRIPTION.
 * _PARAM2 (TYPE): DESCRIPTION.
 *
 * Returns:
 * %RETURNS%
 */

private ["_LeaderX","_loadOut", "_oldBehaviour"];

	_LeaderX = petrovsky getVariable ["owner",leader group petrovsky];
	if (!isPlayer _LeaderX) exitWith {};
	if (captive petrovsky) exitWith {};
	[petrovsky,true] remoteExec ["setCaptive",0,petrovsky];
	petrovsky setCaptive true;
	petrovsky disableAI "TARGET";
	petrovsky disableAI "AUTOTARGET";

	_oldBehaviour = behaviour petrovsky;

	petrovsky setBehaviour "CARELESS";
	petrovsky setUnitPos "UP";
	_loadOut = getUnitLoadout petrovsky;

	petrovsky setUnitLoadout (configFile >> "EmptyLoadout");
	petrovsky forceAddUniform "U_C_FormalSuit_01_tshirt_gray_F"; 
 	petrovsky addHeadgear "H_Hat_grey"; 
 	petrovsky addGoggles "CUP_G_Beard_Shades_Black"; 
 	petrovsky addItem "ItemRadio"; 

	while {(captive _LeaderX) and (captive petrovsky)} do
	{
	sleep 1;
	if !(group petrovsky == group player) exitWith {};
	if ((vehicle petrovsky != petrovsky) and (not((typeOf vehicle petrovsky) in undercoverVehicles))) exitWith {};
	if ((primaryWeapon petrovsky != "") or (secondaryWeapon petrovsky != "") or (handgunWeapon petrovsky != "")) exitWith {};
	};

	if (!captive petrovsky) then {petrovsky groupChat "Shit, they have spotted me!"} else {[petrovsky,false] remoteExec ["setCaptive",0,petrovsky]; petrovsky setCaptive false};
	if (captive player) then {sleep 5};
	petrovsky setBehaviour _oldBehaviour;
	petrovsky enableAI "TARGET";
	petrovsky enableAI "AUTOTARGET";
	petrovsky setUnitPos "AUTO";
	petrovsky setUnitLoadout _loadOut;
